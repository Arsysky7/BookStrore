<!-- /pdf-bookstore/frontend/reset-password.html -->

<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - PDF Bookstore</title>
    <meta name="description" content="Reset password akun PDF Bookstore Anda.">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/improvements.css">
    <link rel="stylesheet" href="css/modern-theme.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .password-strength {
            margin-top: 8px;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            overflow: hidden;
        }

        .password-strength-bar {
            height: 100%;
            width: 0%;
            transition: all 0.3s ease;
        }

        .password-strength-bar.weak {
            width: 33%;
            background: #ef4444;
        }

        .password-strength-bar.medium {
            width: 66%;
            background: #f59e0b;
        }

        .password-strength-bar.strong {
            width: 100%;
            background: #10b981;
        }

        .password-requirements {
            margin-top: 12px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            font-size: 13px;
        }

        .password-requirements ul {
            margin: 0;
            padding-left: 20px;
            color: #64748b;
        }

        .password-requirements li {
            margin: 4px 0;
        }

        .password-requirements li.met {
            color: #10b981;
        }

        .password-requirements li i {
            margin-right: 6px;
        }

        .password-toggle {
            position: absolute;
            right: 40px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #94a3b8;
            transition: color 0.2s;
        }

        .password-toggle:hover {
            color: #4f46e5;
        }
    </style>
</head>

<body class="auth-page">
    <!-- Loading Overlay -->
    <div id="loading-container" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner"></div>
            <div class="loading-message">Loading...</div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="notification-container"></div>

    <!-- Auth Background Animation -->
    <div class="auth-background">
        <div class="floating-book book-1"></div>
        <div class="floating-book book-2"></div>
        <div class="floating-book book-3"></div>
        <div class="gradient-overlay"></div>
    </div>

    <!-- Header Navigation -->
    <header class="header auth-header">
        <div class="container">
            <nav class="navbar">
                <div class="brand">
                    <a href="index.html" class="brand-link">
                        <div class="brand-icon">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <span class="brand-text">PDF Bookstore</span>
                    </a>
                </div>
                <div class="auth-nav">
                    <a href="login.html" class="nav-link">
                        <i class="fas fa-arrow-left"></i>
                        <span>Kembali ke Login</span>
                    </a>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="auth-main">
        <div class="container">
            <div class="auth-container" style="max-width: 550px; margin: 0 auto;">
                <div class="auth-form-wrapper">
                    <div class="auth-header">
                        <div class="auth-icon">
                            <i class="fas fa-lock"></i>
                        </div>
                        <h1 class="auth-title">Reset Password</h1>
                        <p class="auth-subtitle">
                            Masukkan kode reset yang telah dikirim ke email Anda dan buat password baru yang kuat.
                        </p>
                    </div>

                    <form id="resetPasswordForm" class="auth-form">
                        <!-- Reset Token Input -->
                        <div class="form-group">
                            <label for="token" class="form-label">
                                <i class="fas fa-key"></i>
                                Kode Reset (6 digit)
                            </label>
                            <div class="input-wrapper">
                                <input
                                    type="text"
                                    id="token"
                                    name="token"
                                    class="form-input"
                                    placeholder="Masukkan kode 6 digit"
                                    required
                                    maxlength="6"
                                    pattern="[0-9]{6}"
                                    inputmode="numeric"
                                    autocomplete="off"
                                />
                                <span class="input-icon">
                                    <i class="fas fa-hashtag"></i>
                                </span>
                            </div>
                            <small style="color: #64748b; font-size: 12px;">
                                Kode dikirim ke email Anda. Cek folder spam jika tidak menemukannya.
                            </small>
                        </div>

                        <!-- New Password Input -->
                        <div class="form-group">
                            <label for="newPassword" class="form-label">
                                <i class="fas fa-lock"></i>
                                Password Baru
                            </label>
                            <div class="input-wrapper" style="position: relative;">
                                <input
                                    type="password"
                                    id="newPassword"
                                    name="newPassword"
                                    class="form-input"
                                    placeholder="Minimal 8 karakter"
                                    required
                                    minlength="8"
                                    maxlength="128"
                                />
                                <span class="password-toggle" onclick="togglePassword('newPassword')">
                                    <i class="fas fa-eye" id="newPasswordToggleIcon"></i>
                                </span>
                                <span class="input-icon">
                                    <i class="fas fa-shield-alt"></i>
                                </span>
                            </div>
                            <!-- Password Strength Indicator -->
                            <div class="password-strength">
                                <div class="password-strength-bar" id="passwordStrengthBar"></div>
                            </div>
                            <!-- Password Requirements -->
                            <div class="password-requirements">
                                <ul id="passwordRequirements">
                                    <li id="req-length"><i class="fas fa-circle"></i> Minimal 8 karakter</li>
                                    <li id="req-uppercase"><i class="fas fa-circle"></i> Minimal 1 huruf besar</li>
                                    <li id="req-lowercase"><i class="fas fa-circle"></i> Minimal 1 huruf kecil</li>
                                    <li id="req-number"><i class="fas fa-circle"></i> Minimal 1 angka</li>
                                    <li id="req-special"><i class="fas fa-circle"></i> Minimal 1 karakter spesial</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Confirm Password Input -->
                        <div class="form-group">
                            <label for="confirmPassword" class="form-label">
                                <i class="fas fa-lock"></i>
                                Konfirmasi Password
                            </label>
                            <div class="input-wrapper" style="position: relative;">
                                <input
                                    type="password"
                                    id="confirmPassword"
                                    name="confirmPassword"
                                    class="form-input"
                                    placeholder="Ulangi password baru"
                                    required
                                />
                                <span class="password-toggle" onclick="togglePassword('confirmPassword')">
                                    <i class="fas fa-eye" id="confirmPasswordToggleIcon"></i>
                                </span>
                                <span class="input-icon">
                                    <i class="fas fa-check-circle"></i>
                                </span>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-primary btn-block" id="submitBtn">
                            <i class="fas fa-check"></i>
                            <span>Reset Password</span>
                        </button>

                        <!-- Additional Info -->
                        <div class="auth-footer">
                            <p class="auth-link">
                                Belum punya kode?
                                <a href="forgot-password.html">Kirim Kode Reset</a>
                            </p>
                            <p class="auth-link">
                                Ingat password?
                                <a href="login.html">Login Sekarang</a>
                            </p>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/utils.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resetPasswordForm = document.getElementById('resetPasswordForm');
            const submitBtn = document.getElementById('submitBtn');
            const tokenInput = document.getElementById('token');
            const newPasswordInput = document.getElementById('newPassword');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const passwordStrengthBar = document.getElementById('passwordStrengthBar');

            // Check if token is in URL (from email link)
            const urlParams = new URLSearchParams(window.location.search);
            const urlToken = urlParams.get('token');
            if (urlToken) {
                tokenInput.value = urlToken;
            }

            // Password Strength Checker
            newPasswordInput.addEventListener('input', () => {
                const password = newPasswordInput.value;
                checkPasswordStrength(password);
            });

            function checkPasswordStrength(password) {
                const requirements = {
                    length: password.length >= 8,
                    uppercase: /[A-Z]/.test(password),
                    lowercase: /[a-z]/.test(password),
                    number: /[0-9]/.test(password),
                    special: /[^a-zA-Z0-9]/.test(password)
                };

                // Update UI for each requirement
                document.getElementById('req-length').classList.toggle('met', requirements.length);
                document.getElementById('req-uppercase').classList.toggle('met', requirements.uppercase);
                document.getElementById('req-lowercase').classList.toggle('met', requirements.lowercase);
                document.getElementById('req-number').classList.toggle('met', requirements.number);
                document.getElementById('req-special').classList.toggle('met', requirements.special);

                // Calculate strength
                const metCount = Object.values(requirements).filter(Boolean).length;
                passwordStrengthBar.className = 'password-strength-bar';

                if (metCount >= 5) {
                    passwordStrengthBar.classList.add('strong');
                } else if (metCount >= 3) {
                    passwordStrengthBar.classList.add('medium');
                } else if (metCount >= 1) {
                    passwordStrengthBar.classList.add('weak');
                }
            }

            // Form Submit
            resetPasswordForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const token = tokenInput.value.trim();
                const newPassword = newPasswordInput.value;
                const confirmPassword = confirmPasswordInput.value;

                // Validation
                if (!token || token.length !== 6) {
                    showNotification('Masukkan kode reset 6 digit yang valid', 'error');
                    return;
                }

                if (newPassword.length < 8) {
                    showNotification('Password minimal 8 karakter', 'error');
                    return;
                }

                if (newPassword !== confirmPassword) {
                    showNotification('Password dan konfirmasi password tidak sama', 'error');
                    return;
                }

                // Check password strength
                const requirements = {
                    length: newPassword.length >= 8,
                    uppercase: /[A-Z]/.test(newPassword),
                    lowercase: /[a-z]/.test(newPassword),
                    number: /[0-9]/.test(newPassword),
                    special: /[^a-zA-Z0-9]/.test(newPassword)
                };

                const metCount = Object.values(requirements).filter(Boolean).length;
                if (metCount < 3) {
                    showNotification('Password terlalu lemah. Penuhi minimal 3 persyaratan.', 'error');
                    return;
                }

                try {
                    showLoading('Mereset password...');
                    submitBtn.disabled = true;

                    const response = await api.resetPassword(token, newPassword, confirmPassword);

                    hideLoading();

                    if (response.success) {
                        showNotification(response.message || 'Password berhasil direset!', 'success');

                        // Redirect to login after 2 seconds
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 2000);
                    } else {
                        throw new Error(response.message || 'Gagal reset password');
                    }
                } catch (error) {
                    hideLoading();
                    submitBtn.disabled = false;
                    showNotification(error.message || 'Terjadi kesalahan. Pastikan kode reset valid dan belum expired.', 'error');
                }
            });

            // Utility Functions
            function showLoading(message = 'Loading...') {
                const loadingContainer = document.getElementById('loading-container');
                const loadingMessage = loadingContainer.querySelector('.loading-message');
                loadingMessage.textContent = message;
                loadingContainer.style.display = 'flex';
            }

            function hideLoading() {
                document.getElementById('loading-container').style.display = 'none';
            }

            function showNotification(message, type = 'info') {
                const container = document.getElementById('notification-container');
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                `;
                container.appendChild(notification);

                setTimeout(() => {
                    notification.classList.add('fade-out');
                    setTimeout(() => notification.remove(), 300);
                }, 4000);
            }
        });

        // Password Toggle Function
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(inputId + 'ToggleIcon');

            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
    </script>
</body>

</html>
